# L2.7

## Что выведет программа?
## Объяснить работу конвейера с использованием select.

### Подробное объяснение работы программы:

Программа демонстрирует работу конвейера (pipeline) с использованием каналов и оператора `select` для объединения двух потоков данных.

#### Функция `asChan`:
- Принимает переменное количество целых чисел
- Создает буферизованный канал `c`
- Запускает горутину, которая:
  - Итерируется по переданным значениям
  - Отправляет каждое значение в канал
  - Делает случайную паузу от 0 до 1000ms между отправками
  - Закрывает канал после отправки всех значений

#### Функция `merge`:
- Принимает два read-only канала `a` и `b`
- Создает новый канал `c` для результата
- Запускает горутину с бесконечным циклом и `select`:
  - `select` позволяет одновременно ожидать данные из обоих каналов
  - Какой канал первым пришлет данные, тот case и выполнится
  - При получении значения из канала проверяется `ok` (канал открыт/закрыт)
  - Если канал закрыт (`ok == false`), он устанавливается в `nil`
  - Когда оба канала становятся `nil`, результирующий канал закрывается

#### Работа select:
`select` - это конструкция Go для неблокирующего ожидания операций с каналами:
- Блокируется до тех пор, пока один из case не станет готов к выполнению
- Если несколько case готовы одновременно, выбор происходит случайно
- Чтение из `nil` канала блокируется навсегда, поэтому закрытые каналы исключаются из select

#### Почему вывод непредсказуем:
1. Функция `asChan` использует `rand.Sleep()` - случайные задержки
2. `select` выбирает случайно среди готовых каналов
3. Горутины выполняются параллельно и конкурируют за ресурсы

Поэтому порядок чисел в выводе может быть разным при каждом запуске.

```go
package main

import (
  "fmt"
  "math/rand"
  "time"
)

func asChan(vs ...int) <-chan int {
  c := make(chan int)
  go func() {
    for _, v := range vs {
      c <- v
      time.Sleep(time.Duration(rand.Intn(1000)) * time.Millisecond)
    }
  close(c)
}()
  return c
}

func merge(a, b <-chan int) <-chan int {
  c := make(chan int)
  go func() {
    for {
      select {
        case v, ok := <-a:
          if ok {
            c <- v
          } else {
            a = nil
          }
        case v, ok := <-b:
          if ok {
            c <- v
          } else {
            b = nil
          }
        }
        if a == nil && b == nil {
          close(c)
          return
        }
     }
   }()
  return c
}

  func main() {
    rand.Seed(time.Now().Unix())
    a := asChan(1, 3, 5, 7)
    b := asChan(2, 4, 6, 8)
    c := merge(a, b)
    for v := range c {
    fmt.Print(v)
  }
}

```
---

Вывод: 
  21345678
  12436857
  12354768



